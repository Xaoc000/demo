#
# Test Suite of Smoke tests for our Demo docker environment
#
# This suite is built using 'pyresttest' (https://github.com/svanoort/pyresttest)
#
---
- config:
    - testset: "Testing connection to iofog-controller via REST API"

- test:
    - name: "Non Auth Connection"
    - group: "Controller"
    - url: "/api/v3/iofog"
    - expected_status: [404]

- test:
      - name: "Test Status"
      - group: "Controller"
      - url: "/api/v3/status"
      - headers: {'Content-Type': 'application/json'}
      - method: 'POST'
      - expected_status: [200]

- test:
      - name: "Create User"
      - group: "Controller"
      - url: "/api/v3/status"
      - headers: {'Content-Type': 'application/json'}
      - method: 'POST'
      - body: '{"email":"user@domain.com","password":"#Bugs4Fun"}'
      - expected_status: [201]

- test:
      - name: "Authentication using basic auth"
      - group: "Controller"
      - url: "/api/v3/user/login"
      - headers: {'Content-Type': 'application/json'}
      - method: 'POST'
      - body: '{"email":"user@domain.com","password":"#Bugs4Fun"}'
      - expected_status: [200]

- test:
      - name: "Authentication using basic auth"
      - group: "Controller"
      - url: "/api/v3/user/profile"
      - headers: {'Content-Type': 'application/json'}
      - method: 'POST'
      - body: '{"email":"user@domain.com","password":"#Bugs4Fun"}'
      - expected_status: [200]

- test:
      - name: "Authentication using basic auth"
      - group: "Controller"
      - url: "/api/v3/user/profile"
      - headers: {'Content-Type': 'application/json'}
      - method: 'POST'
      - body: '{"Authorization":""}'
      - expected_status: [200]

- test:
    - name: "Registry Creation"
    - group: "Controller"
    - url: "/api/v3/registries"
    - headers: {'Content-Type': 'application/json'}
    - method: 'POST'
    - body: '{"Authorization":${AUTHORIZATION_TOKEN}}'
    - expected_status: [201]

- test:
    - name: "Registry Get"
    - group: "Controller"
    - url: "/api/v3/registries"
    - headers: {'Content-Type': 'application/json'}
    - method: 'GET'
    - body: '{"Authorization":${AUTHORIZATION_TOKEN}}'
    - expected_status: [200]

- test:
    - name: "Registry Creation"
    - group: "Controller"
    - url: "/api/v3/registries/${id}"
    - headers: {'Content-Type': 'application/json'}
    - method: 'GET'
    - body: '{"Authorization":${AUTHORIZATION_TOKEN}}'
    - expected_status: [204]